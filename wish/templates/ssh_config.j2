# Custom SSH Configurations for Wish - (domain: {{ domain }})
# Generated by ansible playbook at {{ now(fmt='%Y-%m-%d %H:%M:%S') }}
#
# Command:
#   ansible-playbook ~/.ansible/wish/prepare_dev_suite.yml

{# Jinja2 Whitespace Control: https://jinja.palletsprojects.com/en/2.11.x/templates/#whitespace-control #}
{% set counter = {} %}
{% for host in groups[domain] %}
{%- set instance = hostvars[host] -%}
{%- set name = instance['tags']['Name'] -%}
{#
  count servers by name
  Read: https://stackoverflow.com/q/36886650/1592264
#}
{%- set _ = counter.update({name: counter.get(name, 0) + 1}) -%}
Host {{ name }}-{{ counter[name] }}
  #     id: {{ instance['instance_id'] }}
  #    env: {{ instance['tags']['Environment'] }}
  #   type: {{ instance['instance_type'] }} cpu: {{ instance['cpu_options']['core_count'] }}
  # region: {{ instance['placement']['region'] }}
  HostName {{ instance['private_ip_address'] }}
  User benzou
  IdentityFile ~/.ssh/rsa_bjs

{% endfor %}
